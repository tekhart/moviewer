<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>목록보기</title>
    <link rel="stylesheet" type="text/css" href="common.css">
    <link rel="shortcut icon" href="img/favi.ico">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready( function() {
            Object.defineProperty(Array.prototype, 'chunk_inefficient', {
                value: function(chunkSize) {
                    var array = this;
                    return [].concat.apply([],
                    array.map(function(elem, i) {
                        return i % chunkSize ? [] : [array.slice(i, i + chunkSize)];
                    })
                    );
                }
            });
            $("#top").load("top.html");
            let url = new URL(location.href);
            let type = url.searchParams.get("type");
            let page = url.searchParams.get("page");
            console.log(type);
            console.log(page);
            $.ajax({
                // type을 설정합니다.
                type : 'GET',
                url : `http://127.0.0.1:5000/${type}/list/${page}`,
                // 사용자가 입력하여 id로 넘어온 값을 서버로 보냅니다.
                // 성공적으로 값을 서버로 보냈을 경우 처리하는 코드입니다.
                success : function (data) {

                    console.log(typeof data);
                    let rottens = JSON.parse(data);
                    let chunked = rottens.chunk_inefficient(5);
                    console.log(chunked);
                    let tableId = 0;
                    chunked.forEach(arr => {
                        $(".listtb").append(`<tr id="tr_${tableId}"></tr>`);
                        arr.forEach(item => {
                            let appendHtml = `<td><a href="detail.html?id=${item[0]}&type=${type}"><img src="${item[1]}" class="poster"></a><div class="titlediv">${item[2]}</div></td>`;
                            $(`#tr_${tableId}`).append(appendHtml)
                        });
                        tableId = tableId + 1;
                    });
                    
                }
            });
        });
    </script>
<style>

</style>
</head>
<body>

<div id="top">
</div>
<div id="wrap">
    <a id="totop"></a>
<center>
<table class="listtb">

   </table>
</center>
    </div>
<script>
$(function(){
    $('#totop').on('click',function(e){
            e.preventDefault();
            $('html,body').animate({scrollTop:0},600);
  });

  $(window).scroll(function() {
    if ($(document).scrollTop() > 100) {
      $('#totop').addClass('show');
    } else {
      $('#totop').removeClass('show');
    }
  });
});
</script>
</body>
</html>